# 新サービスにおける認証・認可手法の検討


## Topics

- JWTの検討

- DDDのアーキテクチャ


## 暗号化方式の検討

- [ ] 共通鍵暗号方式?

- [ ] 個別秘密鍵で暗号化?

## 解決すべき疑問

- [ ] Tokenが盗まれた場合の無効化機構について

結局Session ID的なのをサーバーで保有してチェック？Statelessにはならない?

### 1. JWTのClaimに発行番号のようなものを加え、リクエスト毎にチェックする.

JWTのClaimにトークン発行毎に生成されるユニークIDを持たせる. もし、ユーザーがセッションの無効化=トークンの失効要求をした場合で、トークンの期限内で発行履歴がある場合にClaimの発行IDをチェックする.

その後、発行番号が失効要求と合致する場合にそのリクエストを不許可にする.



**Flow:**

```
User                       Server                       Anonymous
 |                            |                             |
 ├---- Rovoke Request ------> |                             |
 |                            |                             |
 |              [Check Token Generate History]              |
 |                            |                             |
 |                [Enable gen ID check flag]                |
 |                            |                             |
 |                            | <------- Atack Request -----┤
 |                            |                             |
 |                [Check Generate ID claim]                 |
 |                            |                             |
 | <-- Malucious Notify ------|                             |
 |                            |--- Reject Acess Res ------> |
 |                            |                             |
```




## 参考

- [https://creators-note.chatwork.com/entry/2018/09/25/132218](https://creators-note.chatwork.com/entry/2018/09/25/132218)
